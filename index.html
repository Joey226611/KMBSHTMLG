<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<title>Kerst Bingo Host ğŸ„</title>
<style>
body{background:#101820;color:white;font-family:Arial;text-align:center;padding:20px;}
button{padding:15px;font-size:18px;border:none;background:#28a745;color:white;border-radius:10px;margin:10px;cursor:pointer;}
button:active{transform:scale(.95);}
#song{font-size:24px;margin:20px 0;font-weight:bold;}
</style>
</head>
<body>

<h1>ğŸ… Kerst Muziek Bingo - Host</h1>
<p id="status">â³ Verbinden...</p>
<p id="song">Geen liedje</p>

<button id="start">â–¶ Start</button>
<button id="next" disabled>ğŸ”€ Volgende Liedje</button>
<button id="reset">â™» Reset</button>

<script>
/* ---------- CONFIG ---------- */
const BIN = "69244907ae596e708f6d9ca4";
const KEY = "$2a$10$wgQZzbDjasLxt8TGqG52TOPxciwArMKp2mqWH5GEeNR9/wxTf4sn.";
const SONGS = [
 "Mariah Carey - All I Want For Christmas Is You.mp3",
 "Wham - Last Christmas.mp3",
 "Sia - Snowman.mp3",
 "Michael BublÃ© - Holly Jolly Christmas.mp3",
 "Jingle Bell Rock.mp3"
];

let audio = new Audio();
let state = null;

/* ---------- JSONBIN ---------- */
async function readState(){
 const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN}/latest`,{
  headers:{ "X-Master-Key": KEY }
 });
 return (await res.json()).record;
}

async function writeState(data){
 await fetch(`https://api.jsonbin.io/v3/b/${BIN}`,{
  method:"PUT",
  headers:{ "X-Master-Key": KEY, "Content-Type": "application/json" },
  body:JSON.stringify(data)
 });
}

/* ---------- HOST LOGIC ---------- */
async function init(){
 try {state = await readState();}
 catch{state = defaultState(); await writeState(state);}
 document.getElementById("status").innerText = "ğŸ”— Verbonden";

 if(state.mode === "playing") enableControls();
 updateUI();
 setInterval(sync,1500);
}

function defaultState(){
 return {mode:"waiting",players:{},current:null,played:[]}
}

function enableControls(){
 document.getElementById("next").disabled = false;
}

async function start(){
 state.mode="playing";
 await writeState(state);
 enableControls();
}

async function nextSong(){
 const left = SONGS.filter(s=>!state.played.includes(s));
 if(!left.length) return alert("ğŸ„ Alle nummers zijn gespeeld!");
 const pick = left[Math.floor(Math.random()*left.length)];
 state.current = pick;
 state.played.push(pick);
 audio.src = "Muziek/" + pick;
 audio.play();
 await writeState(state);
}

async function reset(){
 state = defaultState();
 await writeState(state);
 location.reload();
}

async function sync(){
 state = await readState();
 updateUI();
}

function updateUI(){
 document.getElementById("song").innerText = state.current || "Geen liedje";
}

document.getElementById("start").onclick = start;
document.getElementById("next").onclick = nextSong;
document.getElementById("reset").onclick = reset;

init();
</script>
</body>
</html>
