<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<title>Kerst Bingo Player ğŸ</title>
<style>
body{background:#162022;color:white;font-family:Arial;text-align:center;padding:20px;}
button{padding:15px;font-size:20px;border:none;background:#ff004c;color:white;border-radius:10px;margin:10px;cursor:pointer;}
button:active{transform:scale(.95);}
#song{font-size:26px;margin-top:20px;}
</style>
</head>
<body>

<h1>ğŸ„ Kerst Muziek Bingo</h1>
<p id="status">â³ Verbinden...</p>
<p id="song">Geen liedje...</p>
<button id="bingo">ğŸ‰ BINGO!</button>

<script>
/* ---------- CONFIG ---------- */
const BIN = "69244907ae596e708f6d9ca4";
const KEY = "$2a$10$wgQZzbDjasLxt8TGqG52TOPxciwArMKp2mqWH5GEeNR9/wxTf4sn.";
const id = crypto.randomUUID();
let state=null;

/* ---------- JSONBIN ---------- */
async function readState(){
 const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN}/latest`,{
  headers:{ "X-Master-Key": KEY }
 });
 return (await res.json()).record;
}

async function writeState(data){
 await fetch(`https://api.jsonbin.io/v3/b/${BIN}`,{
  method:"PUT",
  headers:{ "X-Master-Key": KEY, "Content-Type": "application/json" },
  body:JSON.stringify(data)
 });
}

/* ---------- PLAYER ---------- */
async function init(){
 state = await readState();

 const name = prompt("ğŸ… Vul je naam in:");
 state.players[id] = {name, active: Date.now()};

 await writeState(state);
 document.getElementById("status").innerText = "ğŸ In het spel!";
 setInterval(sync,1500);
 setInterval(heartbeat,7000);
}

async function heartbeat(){
 state = await readState();
 if(state.players[id]) state.players[id].active = Date.now();
 await writeState(state);
}

async function sync(){
 state = await readState();
 document.getElementById("song").innerText = state.current || "Wachten...";
}

window.addEventListener("beforeunload",async()=>{
 state = await readState();
 delete state.players[id];
 await writeState(state);
});

document.getElementById("bingo").onclick = ()=>alert("ğŸ‰ Bingo wordt later visueel!");

init();
</script>
</body>
</html>
